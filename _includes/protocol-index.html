{% assign grouped = site.data.protocols | group_by: "topic" %}

{% for block in grouped %}
<h3> {{ block.name }} </h3>
<table class="protocol-table" id="protocolTable">
  <thead>
    <tr>
      <th data-sort="sop">SOP</th>
      <th data-sort="title">Title</th>
      <th data-sort="topic">Topic</th>
      <th data-sort="status">Status</th>
      <th data-sort="pdf">Download</th>
    </tr>
  </thead>
  <tbody>
  {% for p in site.data.protocols %}
    <tr>
      <td data-value="SOP{{ p.id }}">SOP{{ p.id }}</td>
      <td data-value="{{ p.title | escape }}">{{ p.title }}</td>
      <td data-value="{{ p.topic | escape }}">{{ p.topic }}</td>
      <td data-value="{{ p.status | escape }}">
        {% if p.status == "public" %}
          Public
        {% elsif p.status == "internal" %}
          Internal review
        {% elsif p.status == "drafting" %}
          In preparation
        {% else %}
          {{ p.status }}
        {% endif %}
      </td>
      <td data-value="{% if p.pdf %}1{% else %}0{% endif %}">
        {% if p.pdf %}
          <a href="{{ p.pdf }}">PDF</a>
        {% else %}
          <em>â€”</em>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endfor %}